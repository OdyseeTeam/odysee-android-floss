{"version":3,"file":"740-3334081e59c425a2c0fc-1009.js","mappings":"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","sources":["webpack://odysee.com/../ui/component/commentsList/internal/commentListMenu/view.jsx","webpack://odysee.com/../ui/component/commentsList/internal/commentListMenu/index.js","webpack://odysee.com/../ui/component/commentsList/view.jsx","webpack://odysee.com/../ui/component/commentsList/index.js"],"sourcesContent":["// @flow\n\nimport { Menu, MenuButton, MenuList, MenuItem } from '@reach/menu-button';\n\nimport * as ICONS from 'constants/icons';\n\nimport Icon from 'component/common/icon';\nimport React from 'react';\n\ntype Props = {\n  // -- redux --\n  claimId: ?string,\n  channelId: ?string,\n  channelName: ?string,\n  claimIsMine: boolean,\n  channelHasMembershipTiers: boolean,\n  areCommentsMembersOnly?: boolean,\n  creatorMembershipsFetched: boolean,\n  doToggleMembersOnlyCommentsSettingForClaimId: (claimId: ClaimId) => Promise<any>,\n  doMembershipList: (params: MembershipListParams) => Promise<CreatorMemberships>,\n  doToast: ({ message: string }) => void,\n};\n\nconst CommentListMenu = (props: Props) => {\n  const {\n    // -- redux --\n    claimId,\n    channelId,\n    channelName,\n    claimIsMine,\n    channelHasMembershipTiers,\n    areCommentsMembersOnly,\n    creatorMembershipsFetched,\n    doToggleMembersOnlyCommentsSettingForClaimId,\n    doMembershipList,\n    doToast,\n  } = props;\n\n  function updateMembersOnlyComments() {\n    if (claimId) {\n      doToggleMembersOnlyCommentsSettingForClaimId(claimId).then(() =>\n        doToast({\n          message: __(\n            areCommentsMembersOnly\n              ? 'Members-only comments are now disabled.'\n              : 'Members-only comments are now enabled.'\n          ),\n        })\n      );\n    }\n  }\n\n  React.useEffect(() => {\n    if (!creatorMembershipsFetched && channelName && channelId) {\n      doMembershipList({ channel_claim_id: channelId });\n    }\n  }, [channelId, channelName, creatorMembershipsFetched, doMembershipList]);\n\n  if (channelHasMembershipTiers && claimIsMine) {\n    return (\n      <Menu>\n        <MenuButton className=\"button button--alt menu__button\">\n          <Icon size={18} icon={ICONS.SETTINGS} />\n        </MenuButton>\n\n        <MenuList className=\"menu__list\">\n          <MenuItem className=\"comment__menu-option\" onSelect={() => updateMembersOnlyComments()}>\n            <span className=\"menu__link\">\n              <Icon aria-hidden icon={ICONS.MEMBERSHIP} />\n              {__(areCommentsMembersOnly ? 'Disable members-only comments' : 'Enable members-only comments')}\n            </span>\n          </MenuItem>\n        </MenuList>\n      </Menu>\n    );\n  }\n\n  return null;\n};\n\nexport default CommentListMenu;\n","import { connect } from 'react-redux';\nimport { selectClaimForUri, selectClaimIsMineForUri } from 'redux/selectors/claims';\nimport { selectMembersOnlyCommentsForChannelId } from 'redux/selectors/comments';\nimport {\n  selectChannelHasMembershipTiersForId,\n  selectCreatorMembershipsFetchedByUri,\n} from 'redux/selectors/memberships';\nimport { getChannelFromClaim } from 'util/claim';\n\nimport { doToggleMembersOnlyCommentsSettingForClaimId } from 'redux/actions/comments';\nimport { doMembershipList } from 'redux/actions/memberships';\nimport { doToast } from 'redux/actions/notifications';\n\nimport CommentListMenu from './view';\n\nconst select = (state, props) => {\n  const { uri } = props;\n\n  const claim = selectClaimForUri(state, uri);\n  const claimId = claim && claim.claim_id;\n  const { claim_id: channelId, name: channelName } = getChannelFromClaim(claim) || {};\n\n  return {\n    claimId,\n    channelId,\n    channelName,\n    claimIsMine: selectClaimIsMineForUri(state, uri),\n    channelHasMembershipTiers: channelId && selectChannelHasMembershipTiersForId(state, channelId),\n    areCommentsMembersOnly: channelId && selectMembersOnlyCommentsForChannelId(state, channelId),\n    creatorMembershipsFetched: selectCreatorMembershipsFetchedByUri(state, uri),\n  };\n};\n\nconst perform = {\n  doToggleMembersOnlyCommentsSettingForClaimId,\n  doMembershipList,\n  doToast,\n};\n\nexport default connect(select, perform)(CommentListMenu);\n","// @flow\nimport {\n  COMMENT_PAGE_SIZE_TOP_LEVEL,\n  SORT_BY,\n  LINKED_COMMENT_QUERY_PARAM,\n  THREAD_COMMENT_QUERY_PARAM,\n} from 'constants/comment';\nimport { ENABLE_COMMENT_REACTIONS } from 'config';\nimport { useIsMobile, useIsSmallScreen } from 'effects/use-screensize';\nimport { getCommentsListTitle } from 'util/comments';\nimport * as ICONS from 'constants/icons';\nimport * as REACTION_TYPES from 'constants/reactions';\nimport Button from 'component/button';\nimport Card from 'component/common/card';\nimport classnames from 'classnames';\nimport CommentView from 'component/comment';\nimport debounce from 'util/debounce';\nimport Empty from 'component/common/empty';\nimport React, { useEffect } from 'react';\nimport Spinner from 'component/spinner';\nimport usePersistedState from 'effects/use-persisted-state';\nimport { useHistory } from 'react-router-dom';\nimport CommentListMenu from './internal/commentListMenu';\nimport { lazyImport } from 'util/lazyImport';\n\nconst DEBOUNCE_SCROLL_HANDLER_MS = 200;\nconst CommentCreate = lazyImport(() => import('component/commentCreate' /* webpackChunkName: \"comments\" */));\n\nfunction scaleToDevicePixelRatio(value) {\n  const devicePixelRatio = window.devicePixelRatio || 1.0;\n  if (devicePixelRatio < 1.0) {\n    return Math.ceil(value / devicePixelRatio);\n  }\n  return Math.ceil(value * devicePixelRatio);\n}\n\n// ****************************************************************************\n// ****************************************************************************\n\nexport type Props = {|\n  uri: string,\n  linkedCommentId?: string,\n  commentsAreExpanded?: boolean,\n  threadCommentId: ?string,\n  notInDrawer?: boolean,\n|};\n\ntype StateProps = {|\n  topLevelComments: Array<Comment>,\n  pinnedComments: Array<Comment>,\n  allCommentIds: Array<CommentId>,\n  threadComment: ?Comment, // comment object for 'threadCommentId'\n  totalComments: number,\n  topLevelTotalPages: number,\n  threadCommentAncestors: ?Array<string>,\n  linkedCommentAncestors: ?Array<string>,\n  myReactsByCommentId: ?{ [string]: Array<string> }, // \"CommentId:MyChannelId\" -> reaction array (note the ID concatenation)\n  othersReactsById: ?{ [string]: { [REACTION_TYPES.LIKE | REACTION_TYPES.DISLIKE]: number } },\n  commentsEnabledSetting: ?boolean,\n  claimId: ?string,\n  channelId: ?string,\n  claimIsMine: ?boolean,\n  activeChannelId: ?string,\n  isFetchingComments: boolean,\n  isFetchingTopLevelComments: boolean,\n  isFetchingReacts: boolean,\n  fetchingChannels: boolean,\n  chatCommentsRestrictedToChannelMembers: boolean,\n  isAChannelMember: boolean,\n  scheduledState: ClaimScheduledState,\n|};\n\ntype DispatchProps = {|\n  fetchTopLevelComments: (\n    uri: string,\n    parentId: ?string,\n    page: number,\n    pageSize: number,\n    sortBy: number,\n    isLivestream?: boolean\n  ) => void,\n  fetchComment: (CommentId) => void,\n  fetchReacts: (Array<CommentId>) => Promise<any>,\n  resetComments: (ClaimId) => void,\n  doFetchOdyseeMembershipForChannelIds: (claimIds: ClaimIds) => void,\n  doFetchChannelMembershipsForChannelIds: (channelId: string, claimIds: Array<string>) => void,\n  doPopOutInlinePlayer: (param: { source: string }) => void,\n|};\n\n// ****************************************************************************\n// CommentList\n// ****************************************************************************\n\nexport default function CommentList(props: Props & StateProps & DispatchProps) {\n  const {\n    allCommentIds,\n    uri,\n    pinnedComments,\n    topLevelComments,\n    topLevelTotalPages,\n    claimId,\n    channelId,\n    claimIsMine,\n    isFetchingComments,\n    isFetchingTopLevelComments,\n    isFetchingReacts,\n    linkedCommentId,\n    totalComments,\n    fetchingChannels,\n    myReactsByCommentId,\n    othersReactsById,\n    activeChannelId,\n    commentsEnabledSetting,\n    commentsAreExpanded,\n    threadCommentId,\n    threadComment,\n    notInDrawer,\n    threadCommentAncestors,\n    linkedCommentAncestors,\n    fetchTopLevelComments,\n    fetchComment,\n    fetchReacts,\n    resetComments,\n    doFetchOdyseeMembershipForChannelIds,\n    doPopOutInlinePlayer,\n    doFetchChannelMembershipsForChannelIds,\n    chatCommentsRestrictedToChannelMembers,\n    isAChannelMember,\n    scheduledState,\n  } = props;\n\n  const threadRedirect = React.useRef(false);\n\n  const {\n    push,\n    location: { pathname, search },\n  } = useHistory();\n\n  const isMobile = useIsMobile();\n  const isSmallScreen = useIsSmallScreen();\n\n  const currentFetchedPage = Math.ceil(topLevelComments.length / COMMENT_PAGE_SIZE_TOP_LEVEL);\n  const spinnerRef = React.useRef();\n  const commentListRef = React.useRef();\n  const DEFAULT_SORT = ENABLE_COMMENT_REACTIONS ? SORT_BY.POPULARITY : SORT_BY.NEWEST;\n  const [sort, setSort] = usePersistedState('comment-sort-by', DEFAULT_SORT);\n  const [page, setPage] = React.useState(currentFetchedPage > 0 ? currentFetchedPage : 1);\n  const [didInitialPageFetch, setInitialPageFetch] = React.useState(false);\n  const hasDefaultExpansion = commentsAreExpanded || !isSmallScreen || isMobile;\n  const [expandedComments, setExpandedComments] = React.useState(hasDefaultExpansion);\n  const [debouncedUri, setDebouncedUri] = React.useState();\n\n  const [uiFilteredComments, setUiFilteredComments] = React.useState([]);\n  const updateUiFilteredComments = React.useCallback((commentIds) => {\n    setUiFilteredComments((prevCommentIds) => {\n      const newCommentIds = commentIds.filter((id) => !prevCommentIds.includes(id));\n      return newCommentIds.length > 0 ? [...prevCommentIds, ...newCommentIds] : prevCommentIds;\n    });\n  }, []);\n\n  const totalUnfilteredComments = totalComments > 0 ? totalComments - uiFilteredComments.length : totalComments;\n\n  const totalFetchedComments = allCommentIds ? allCommentIds.length : 0;\n  const moreBelow = page < topLevelTotalPages;\n  const title = getCommentsListTitle(totalUnfilteredComments);\n  const threadDepthLevel = isMobile ? 3 : 10;\n  let threadCommentParent;\n  if (threadCommentAncestors) {\n    threadCommentAncestors.some((ancestor, index) => {\n      if (index >= threadDepthLevel - 1) return true;\n\n      threadCommentParent = ancestor;\n    });\n  }\n  const threadTopLevelComment = threadCommentAncestors && threadCommentAncestors[threadCommentAncestors.length - 1];\n\n  // Display comments immediately if not fetching reactions\n  // If not, wait to show comments until reactions are fetched\n  const [readyToDisplayComments, setReadyToDisplayComments] = React.useState(\n    Boolean(othersReactsById) || !ENABLE_COMMENT_REACTIONS\n  );\n\n  // get commenter claim ids for checking premium status\n  const commenterClaimIds = React.useMemo(() => {\n    return topLevelComments.map((comment) => comment.channel_id);\n  }, [topLevelComments]);\n\n  React.useEffect(() => {\n    if (commenterClaimIds.length > 0 && channelId) {\n      doFetchOdyseeMembershipForChannelIds(commenterClaimIds);\n      doFetchChannelMembershipsForChannelIds(channelId, commenterClaimIds);\n    }\n    // todo: investigate why topLevelComments triggers a re-render even though the comments are the same\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- keep commenterClaimIds.length instead\n  }, [\n    channelId,\n    commenterClaimIds.length,\n    doFetchChannelMembershipsForChannelIds,\n    doFetchOdyseeMembershipForChannelIds,\n  ]);\n\n  const handleReset = React.useCallback(() => {\n    if (claimId) resetComments(claimId);\n    setPage(1);\n  }, [claimId, resetComments]);\n\n  function refreshComments() {\n    // Invalidate existing comments\n    setPage(0);\n    doPopOutInlinePlayer({ source: 'comment' });\n  }\n\n  function changeSort(newSort) {\n    if (sort !== newSort) {\n      setSort(newSort);\n      refreshComments();\n      doPopOutInlinePlayer({ source: 'comment' });\n    }\n  }\n\n  // If a linked comment is deep within a thread, redirect to it's own thread page\n  // based on the set depthLevel (mobile/desktop)\n  React.useEffect(() => {\n    if (\n      !threadCommentId &&\n      linkedCommentId &&\n      linkedCommentAncestors &&\n      linkedCommentAncestors.length > threadDepthLevel - 1 &&\n      !threadRedirect.current\n    ) {\n      const urlParams = new URLSearchParams(search);\n      urlParams.set(THREAD_COMMENT_QUERY_PARAM, linkedCommentId);\n\n      push({ pathname, search: urlParams.toString() });\n      // to do it only once\n      threadRedirect.current = true;\n    }\n  }, [linkedCommentAncestors, linkedCommentId, pathname, push, search, threadCommentId, threadDepthLevel]);\n\n  // TODO: still have to change this to use the new check\n  const notAuthedToChat = chatCommentsRestrictedToChannelMembers && !isAChannelMember && !claimIsMine;\n\n  // set new page on scroll debounce and avoid setting the page after navigated uris\n  useEffect(() => {\n    if (debouncedUri && debouncedUri === uri) {\n      setPage(page + 1);\n      setDebouncedUri(undefined);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- Only for comparing uri with debounced uri\n  }, [debouncedUri, uri]);\n\n  // Force comments reset\n  useEffect(() => {\n    if (page === 0) {\n      handleReset();\n    }\n  }, [handleReset, page]);\n\n  // Set page back to 1 on every claim switch\n  useEffect(() => {\n    return () => setPage(1);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [uri]);\n\n  // When navigating to a new claim, the page will be 1 due to the above\n  // and if there was already fetched top level comments, the fetched page will be higher\n  // so set the current page as the fetched page to start fetching new pages from there\n  useEffect(() => {\n    if (page < currentFetchedPage) setPage(currentFetchedPage > 0 ? currentFetchedPage : 1);\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- Only on uri change\n  }, [uri]);\n\n  // Fetch top-level comments\n  useEffect(() => {\n    const isInitialFetch = currentFetchedPage === 0;\n    const isNewPage = page !== 1 && page !== currentFetchedPage;\n    // only one or the other should be true, if both are true it means\n    // it will fetch the wrong page initially. needs Number so it's 0 or 1\n    const hasRightFetchPage = Number(isInitialFetch) ^ Number(isNewPage);\n\n    if (page !== 0 && hasRightFetchPage) {\n      if (page === 1) {\n        if (threadCommentId) {\n          fetchComment(threadCommentId);\n        }\n        if (linkedCommentId) {\n          fetchComment(linkedCommentId);\n        }\n      }\n\n      fetchTopLevelComments(uri, undefined, page, COMMENT_PAGE_SIZE_TOP_LEVEL, sort, false);\n    }\n  }, [currentFetchedPage, fetchComment, fetchTopLevelComments, linkedCommentId, page, sort, threadCommentId, uri]);\n\n  React.useEffect(() => {\n    if (threadCommentId) {\n      refreshComments();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- @see TODO_NEED_VERIFICATION\n  }, [threadCommentId]);\n\n  // Fetch reacts\n  useEffect(() => {\n    if (totalFetchedComments > 0 && ENABLE_COMMENT_REACTIONS && !fetchingChannels && !isFetchingReacts) {\n      let idsForReactionFetch;\n\n      if (!othersReactsById || !myReactsByCommentId) {\n        idsForReactionFetch = allCommentIds;\n      } else {\n        idsForReactionFetch = allCommentIds.filter((commentId) => {\n          const key = activeChannelId ? `${commentId}:${activeChannelId}` : commentId;\n          return !othersReactsById[key] || (activeChannelId && !myReactsByCommentId[key]);\n        });\n      }\n\n      if (idsForReactionFetch.length !== 0) {\n        fetchReacts(idsForReactionFetch)\n          .then(() => {\n            setReadyToDisplayComments(true);\n          })\n          .catch(() => setReadyToDisplayComments(true));\n      }\n    }\n  }, [\n    activeChannelId,\n    allCommentIds,\n    fetchReacts,\n    fetchingChannels,\n    isFetchingReacts,\n    myReactsByCommentId,\n    othersReactsById,\n    totalFetchedComments,\n  ]);\n\n  // Scroll to linked-comment\n  useEffect(() => {\n    if (linkedCommentId || threadCommentId) {\n      window.pendingLinkedCommentScroll = true;\n    } else {\n      delete window.pendingLinkedCommentScroll;\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Infinite scroll\n  useEffect(() => {\n    if (topLevelComments.length === 0) return;\n\n    function shouldFetchNextPage(page, topLevelTotalPages, yPrefetchPx = 1000) {\n      if (!spinnerRef || !spinnerRef.current) return false;\n\n      const rect = spinnerRef.current.getBoundingClientRect(); // $FlowFixMe\n      const windowH = window.innerHeight || document.documentElement.clientHeight; // $FlowFixMe\n      const windowW = window.innerWidth || document.documentElement.clientWidth;\n\n      const isApproachingViewport = yPrefetchPx !== 0 && rect.top < windowH + scaleToDevicePixelRatio(yPrefetchPx);\n\n      const isInViewport =\n        rect.width > 0 &&\n        rect.height > 0 &&\n        rect.bottom >= 0 &&\n        rect.right >= 0 &&\n        rect.top <= windowH &&\n        rect.left <= windowW;\n\n      return (isInViewport || isApproachingViewport) && page < topLevelTotalPages;\n    }\n\n    const handleCommentScroll = debounce(() => {\n      if (shouldFetchNextPage(page, topLevelTotalPages)) {\n        setDebouncedUri(uri);\n        setInitialPageFetch(true);\n      }\n    }, DEBOUNCE_SCROLL_HANDLER_MS);\n\n    if (!didInitialPageFetch) {\n      handleCommentScroll();\n      setInitialPageFetch(true);\n    }\n\n    if (hasDefaultExpansion && !isFetchingComments && readyToDisplayComments && moreBelow) {\n      const commentsInDrawer = Boolean(document.querySelector('.MuiDrawer-root .card--enable-overflow'));\n      const scrollingElement = commentsInDrawer ? document.querySelector('.card--enable-overflow') : window;\n\n      if (scrollingElement) {\n        scrollingElement.addEventListener('scroll', handleCommentScroll);\n\n        return () => scrollingElement.removeEventListener('scroll', handleCommentScroll);\n      }\n    }\n  }, [\n    topLevelComments,\n    hasDefaultExpansion,\n    didInitialPageFetch,\n    isFetchingComments,\n    isMobile,\n    moreBelow,\n    page,\n    readyToDisplayComments,\n    topLevelTotalPages,\n    uri,\n  ]);\n\n  const commentProps = {\n    isTopLevel: true,\n    uri,\n    linkedCommentId,\n    threadCommentId,\n    threadDepthLevel,\n  };\n\n  const actionButtonsProps = {\n    uri,\n    totalUnfilteredComments,\n    sort,\n    changeSort,\n    handleRefresh: refreshComments,\n  };\n\n  if (scheduledState === 'scheduled') {\n    // Not ready yet, so hide it.\n    return null;\n  }\n\n  return (\n    <Card\n      className=\"card--enable-overflow comment__list\"\n      title={(!isMobile || notInDrawer) && title}\n      titleActions={<CommentActionButtons {...actionButtonsProps} />}\n      actions={\n        <>\n          {isMobile && !notInDrawer && <CommentActionButtons {...actionButtonsProps} />}\n\n          <CommentCreate uri={uri} />\n\n          {threadCommentId && threadComment && (\n            <span className=\"comment__actions comment__thread-links\">\n              <ThreadLinkButton\n                label={__('View all comments')}\n                threadCommentParent={threadTopLevelComment || threadCommentId}\n                threadCommentId={threadCommentId}\n                isViewAll\n              />\n\n              {threadCommentParent && (\n                <ThreadLinkButton\n                  label={__('Show parent comments')}\n                  threadCommentParent={threadCommentParent}\n                  threadCommentId={threadCommentId}\n                />\n              )}\n            </span>\n          )}\n\n          {commentsEnabledSetting && !isFetchingComments && !totalUnfilteredComments && !threadCommentId && (\n            <Empty padded text={__('That was pretty deep. What do you think?')} />\n          )}\n\n          <ul\n            ref={commentListRef}\n            className={classnames('comments', {\n              'comments--contracted': isSmallScreen && !expandedComments && totalUnfilteredComments > 1,\n            })}\n          >\n            {readyToDisplayComments && (\n              <>\n                {threadComment && (\n                  <CommentView\n                    key={threadComment.comment_id}\n                    comment={threadComment}\n                    disabled={notAuthedToChat}\n                    updateUiFilteredComments={updateUiFilteredComments}\n                    {...commentProps}\n                  />\n                )}\n                {pinnedComments &&\n                  pinnedComments.map((c) => {\n                    if (threadComment && threadCommentAncestors && threadCommentAncestors.includes(c.comment_id)) {\n                      // Skip if part of the linked comment thread - thread is shown at the top\n                      return;\n                    }\n                    return (\n                      <CommentView\n                        key={c.comment_id}\n                        comment={c}\n                        disabled={notAuthedToChat}\n                        updateUiFilteredComments={updateUiFilteredComments}\n                        {...commentProps}\n                      />\n                    );\n                  })}\n\n                {topLevelComments.map((c) => {\n                  if (threadComment && threadCommentAncestors && threadCommentAncestors.includes(c.comment_id)) {\n                    // Skip if part of the linked comment thread - thread is shown at the top\n                    return;\n                  }\n                  return (\n                    <CommentView\n                      key={c.comment_id}\n                      comment={c}\n                      disabled={notAuthedToChat}\n                      updateUiFilteredComments={updateUiFilteredComments}\n                      {...commentProps}\n                    />\n                  );\n                })}\n              </>\n            )}\n          </ul>\n\n          {!hasDefaultExpansion && (\n            <div className=\"card__bottom-actions card__bottom-actions--comments\">\n              {(!expandedComments || moreBelow) && totalUnfilteredComments > 1 && (\n                <Button\n                  button=\"link\"\n                  title={!expandedComments ? __('Expand') : __('More')}\n                  label={!expandedComments ? __('Expand') : __('More')}\n                  onClick={() => (!expandedComments ? setExpandedComments(true) : setPage(page + 1))}\n                />\n              )}\n              {expandedComments && totalUnfilteredComments > 1 && (\n                <Button\n                  button=\"link\"\n                  title={__('Collapse')}\n                  label={__('Collapse')}\n                  onClick={() => {\n                    setExpandedComments(false);\n                    if (commentListRef.current) {\n                      const ADDITIONAL_OFFSET = 200;\n                      const refTop = commentListRef.current.getBoundingClientRect().top;\n                      window.scrollTo({\n                        top: refTop + window.pageYOffset - ADDITIONAL_OFFSET,\n                        behavior: 'smooth',\n                      });\n                    }\n                  }}\n                />\n              )}\n            </div>\n          )}\n\n          {(threadCommentId\n            ? !readyToDisplayComments\n            : isFetchingTopLevelComments || (hasDefaultExpansion && moreBelow)) && (\n            <div className=\"main--empty\" ref={spinnerRef}>\n              <Spinner type=\"small\" />\n            </div>\n          )}\n        </>\n      }\n    />\n  );\n}\n\ntype ActionButtonsProps = {\n  uri: string,\n  totalUnfilteredComments: number,\n  sort: string,\n  changeSort: (string) => void,\n  handleRefresh: () => void,\n};\n\nconst CommentActionButtons = (actionButtonsProps: ActionButtonsProps) => {\n  const { uri, totalUnfilteredComments, sort, changeSort, handleRefresh } = actionButtonsProps;\n\n  const sortButtonProps = { activeSort: sort, changeSort };\n\n  return (\n    <div className=\"comment__actions\">\n      {totalUnfilteredComments > 1 && ENABLE_COMMENT_REACTIONS && (\n        <span className=\"comment__sort\">\n          <SortButton {...sortButtonProps} label={__('Best')} icon={ICONS.BEST} sortOption={SORT_BY.POPULARITY} />\n          <SortButton\n            {...sortButtonProps}\n            label={__('Controversial')}\n            icon={ICONS.CONTROVERSIAL}\n            sortOption={SORT_BY.CONTROVERSY}\n          />\n          <SortButton {...sortButtonProps} label={__('New')} icon={ICONS.NEW} sortOption={SORT_BY.NEWEST} />\n        </span>\n      )}\n\n      <div className=\"comment__settings\">\n        <Button button=\"alt\" icon={ICONS.REFRESH} title={__('Refresh')} onClick={handleRefresh} />\n        <CommentListMenu uri={uri} />\n      </div>\n    </div>\n  );\n};\n\ntype SortButtonProps = {\n  activeSort: string,\n  sortOption: string,\n  changeSort: (string) => void,\n};\n\nconst SortButton = (sortButtonProps: SortButtonProps) => {\n  const { activeSort, sortOption, changeSort, ...buttonProps } = sortButtonProps;\n\n  return (\n    <Button\n      {...buttonProps}\n      className={classnames(`button-toggle`, { 'button-toggle--active': activeSort === sortOption })}\n      button=\"alt\"\n      iconSize={18}\n      onClick={() => changeSort(sortOption)}\n    />\n  );\n};\n\ntype ThreadLinkProps = {\n  label: string,\n  isViewAll?: boolean,\n  threadCommentParent: string,\n  threadCommentId: string,\n};\n\nconst ThreadLinkButton = (props: ThreadLinkProps) => {\n  const { label, isViewAll, threadCommentParent, threadCommentId } = props;\n\n  const {\n    push,\n    location: { pathname, search },\n  } = useHistory();\n\n  return (\n    <Button\n      button=\"link\"\n      label={label}\n      icon={ICONS.ARROW_LEFT}\n      iconSize={12}\n      onClick={() => {\n        const urlParams = new URLSearchParams(search);\n\n        if (!isViewAll) {\n          urlParams.set(THREAD_COMMENT_QUERY_PARAM, threadCommentParent);\n          // on moving back, link the current thread comment so that it auto-expands into the correct conversation\n          urlParams.set(LINKED_COMMENT_QUERY_PARAM, threadCommentId);\n        } else {\n          urlParams.delete(THREAD_COMMENT_QUERY_PARAM);\n          // links the top-level comment when going back to all comments, for easy locating\n          // in the middle of big comment sections\n          urlParams.set(LINKED_COMMENT_QUERY_PARAM, threadCommentParent);\n        }\n        window.pendingLinkedCommentScroll = true;\n\n        push({ pathname, search: urlParams.toString() });\n      }}\n    />\n  );\n};\n","// @flow\nimport type { Props } from './view';\nimport CommentsList from './view';\nimport { connect } from 'react-redux';\nimport {\n  selectClaimForUri,\n  selectClaimIsMine,\n  selectFetchingMyChannels,\n  selectScheduledStateForUri,\n  selectProtectedContentTagForUri,\n} from 'redux/selectors/claims';\nimport {\n  selectTopLevelCommentsForUri,\n  selectTopLevelTotalPagesForUri,\n  selectIsFetchingComments,\n  selectIsFetchingTopLevelComments,\n  selectIsFetchingReacts,\n  selectTotalCommentsCountForUri,\n  selectOthersReacts,\n  selectMyReacts,\n  selectCommentIdsForUri,\n  selectCommentsEnabledSettingForChannelId,\n  selectPinnedCommentsForUri,\n  selectCommentForCommentId,\n  selectCommentAncestorsForId,\n} from 'redux/selectors/comments';\nimport { doCommentReset, doCommentList, doCommentById, doCommentReactList } from 'redux/actions/comments';\nimport { doPopOutInlinePlayer } from 'redux/actions/content';\nimport { selectActiveChannelClaim } from 'redux/selectors/app';\nimport { getChannelIdFromClaim } from 'util/claim';\nimport {\n  doFetchOdyseeMembershipForChannelIds,\n  doFetchChannelMembershipsForChannelIds,\n} from 'redux/actions/memberships';\nimport { selectUserHasValidMembershipForCreatorId } from 'redux/selectors/memberships';\n\nconst select = (state, props) => {\n  const { uri, threadCommentId, linkedCommentId } = props;\n\n  const claim = selectClaimForUri(state, uri);\n  const channelId = getChannelIdFromClaim(claim);\n\n  const activeChannelClaim = selectActiveChannelClaim(state);\n  const threadComment = selectCommentForCommentId(state, threadCommentId);\n  const activeChannelId = activeChannelClaim && activeChannelClaim.claim_id;\n\n  return {\n    activeChannelId,\n    allCommentIds: selectCommentIdsForUri(state, uri),\n    channelId,\n    chatCommentsRestrictedToChannelMembers: Boolean(selectProtectedContentTagForUri(state, uri)),\n    claimId: claim && claim.claim_id,\n    claimIsMine: selectClaimIsMine(state, claim),\n    fetchingChannels: selectFetchingMyChannels(state),\n    // $FlowFixMe\n    isAChannelMember: selectUserHasValidMembershipForCreatorId(state, channelId),\n    isFetchingComments: selectIsFetchingComments(state),\n    isFetchingReacts: selectIsFetchingReacts(state),\n    isFetchingTopLevelComments: selectIsFetchingTopLevelComments(state),\n    linkedCommentAncestors: selectCommentAncestorsForId(state, linkedCommentId),\n    // $FlowFixMe\n    commentsEnabledSetting: selectCommentsEnabledSettingForChannelId(state, channelId),\n    myReactsByCommentId: selectMyReacts(state),\n    othersReactsById: selectOthersReacts(state),\n    pinnedComments: selectPinnedCommentsForUri(state, uri),\n    threadComment,\n    threadCommentAncestors: selectCommentAncestorsForId(state, threadCommentId),\n    topLevelComments: selectTopLevelCommentsForUri(state, uri),\n    topLevelTotalPages: selectTopLevelTotalPagesForUri(state, uri),\n    totalComments: selectTotalCommentsCountForUri(state, uri),\n    scheduledState: selectScheduledStateForUri(state, uri),\n  };\n};\n\nconst perform = {\n  fetchTopLevelComments: doCommentList,\n  fetchComment: doCommentById,\n  fetchReacts: doCommentReactList,\n  resetComments: doCommentReset,\n  doFetchOdyseeMembershipForChannelIds,\n  doFetchChannelMembershipsForChannelIds,\n  doPopOutInlinePlayer,\n};\n\nexport default connect<_, Props, _, _, _, _>(select, perform)(CommentsList);\n"],"names":["props","claimId","channelId","channelName","claimIsMine","channelHasMembershipTiers","areCommentsMembersOnly","creatorMembershipsFetched","doToggleMembersOnlyCommentsSettingForClaimId","doMembershipList","doToast","React","channel_claim_id","Menu","MenuButton","className","Icon","size","icon","ICONS","MenuList","MenuItem","onSelect","then","message","__","perform","connect","state","uri","claim","selectClaimForUri","claim_id","_ref","getChannelFromClaim","name","selectClaimIsMineForUri","selectChannelHasMembershipTiersForId","selectMembersOnlyCommentsForChannelId","selectCreatorMembershipsFetchedByUri","CommentListMenu","DEBOUNCE_SCROLL_HANDLER_MS","CommentCreate","lazyImport","CommentActionButtons","actionButtonsProps","totalUnfilteredComments","sort","changeSort","handleRefresh","sortButtonProps","activeSort","ENABLE_COMMENT_REACTIONS","SortButton","_extends","label","sortOption","SORT_BY","Button","button","title","onClick","buttonProps","_objectWithoutProperties","_excluded","classnames","iconSize","ThreadLinkButton","isViewAll","threadCommentParent","threadCommentId","_useHistory2","useHistory","push","_useHistory2$location","location","pathname","search","urlParams","URLSearchParams","THREAD_COMMENT_QUERY_PARAM","set","LINKED_COMMENT_QUERY_PARAM","window","pendingLinkedCommentScroll","toString","fetchTopLevelComments","doCommentList","fetchComment","doCommentById","fetchReacts","doCommentReactList","resetComments","doCommentReset","doFetchOdyseeMembershipForChannelIds","doFetchChannelMembershipsForChannelIds","doPopOutInlinePlayer","linkedCommentId","getChannelIdFromClaim","activeChannelClaim","selectActiveChannelClaim","threadComment","selectCommentForCommentId","activeChannelId","allCommentIds","selectCommentIdsForUri","chatCommentsRestrictedToChannelMembers","Boolean","selectProtectedContentTagForUri","selectClaimIsMine","fetchingChannels","selectFetchingMyChannels","isAChannelMember","selectUserHasValidMembershipForCreatorId","isFetchingComments","selectIsFetchingComments","isFetchingReacts","selectIsFetchingReacts","isFetchingTopLevelComments","selectIsFetchingTopLevelComments","linkedCommentAncestors","selectCommentAncestorsForId","commentsEnabledSetting","selectCommentsEnabledSettingForChannelId","myReactsByCommentId","selectMyReacts","othersReactsById","selectOthersReacts","pinnedComments","selectPinnedCommentsForUri","threadCommentAncestors","topLevelComments","selectTopLevelCommentsForUri","topLevelTotalPages","selectTopLevelTotalPagesForUri","totalComments","selectTotalCommentsCountForUri","scheduledState","selectScheduledStateForUri","commentsAreExpanded","notInDrawer","threadRedirect","_useHistory","_useHistory$location","isMobile","useIsMobile","isSmallScreen","useIsSmallScreen","currentFetchedPage","Math","ceil","length","COMMENT_PAGE_SIZE_TOP_LEVEL","spinnerRef","commentListRef","DEFAULT_SORT","_usePersistedState2","_slicedToArray","usePersistedState","setSort","_React$useState2","page","setPage","_React$useState4","didInitialPageFetch","setInitialPageFetch","hasDefaultExpansion","_React$useState6","expandedComments","setExpandedComments","_React$useState8","debouncedUri","setDebouncedUri","_React$useState10","uiFilteredComments","setUiFilteredComments","updateUiFilteredComments","commentIds","prevCommentIds","newCommentIds","filter","id","includes","concat","_toConsumableArray","totalFetchedComments","moreBelow","getCommentsListTitle","threadDepthLevel","some","ancestor","index","threadTopLevelComment","_React$useState12","readyToDisplayComments","setReadyToDisplayComments","commenterClaimIds","map","comment","channel_id","handleReset","refreshComments","source","current","notAuthedToChat","useEffect","undefined","isNewPage","hasRightFetchPage","Number","idsForReactionFetch","commentId","key","handleCommentScroll","debounce","shouldFetchNextPage","scrollingElement","document","querySelector","addEventListener","removeEventListener","yPrefetchPx","arguments","value","devicePixelRatio","rect","getBoundingClientRect","windowH","innerHeight","documentElement","clientHeight","windowW","innerWidth","clientWidth","isApproachingViewport","top","width","height","bottom","right","left","commentProps","isTopLevel","newSort","Card","titleActions","actions","Empty","padded","text","ref","CommentView","comment_id","disabled","c","refTop","scrollTo","pageYOffset","behavior","Spinner","type"],"sourceRoot":""}