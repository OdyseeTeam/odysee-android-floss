{"version":3,"file":"videoPlayersPage-9cb3fce0697b39ae1635-1009.js","mappings":"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","sources":["webpack://odysee.com/../ui/component/videoClaimInitiator/view.jsx","webpack://odysee.com/../ui/component/videoClaimInitiator/index.js","webpack://odysee.com/../ui/page/claim/internal/claimPageComponent/internal/streamClaimPage/internal/videoPlayers/index.js","webpack://odysee.com/../ui/page/claim/internal/claimPageComponent/internal/streamClaimPage/internal/videoPlayers/view.jsx"],"sourcesContent":["// @flow\n// This component is entirely for triggering the start of a video claim view\n// A video/audio claim will actually be rendered by VideoRenderFloating, which\n// will use this component to properly position itself based on the ClaimCoverRender\nimport React from 'react';\n\nimport Button from 'component/button';\nimport ClaimCoverRender from 'component/claimCoverRender';\n\ntype Props = {\n  // -- withStreamClaimRender --\n  uri: string,\n  children?: any,\n  streamClaim: () => void,\n  // -- redux --\n  doSetMainPlayerDimension: (dimensions: { height: number, width: number }) => void,\n};\n\nconst VideoClaimInitiator = (props: Props) => {\n  const { uri, children, streamClaim, doSetMainPlayerDimension } = props;\n\n  const playerRef = React.useCallback(\n    (node) => {\n      if (node) {\n        const rect = node.getBoundingClientRect();\n        doSetMainPlayerDimension(rect);\n      }\n    },\n    [doSetMainPlayerDimension]\n  );\n\n  return (\n    <ClaimCoverRender uri={uri} onClick={streamClaim} passedRef={playerRef}>\n      <Button className=\"button--icon button--play\" onClick={streamClaim} iconSize={30} title={__('Play')} />\n      {children}\n    </ClaimCoverRender>\n  );\n};\n\nexport default VideoClaimInitiator;\n","import { connect } from 'react-redux';\n\nimport { doSetMainPlayerDimension } from 'redux/actions/app';\nimport withStreamClaimRender from 'hocs/withStreamClaimRender';\n\nimport VideoClaimInitiator from './view';\n\nconst perform = {\n  doSetMainPlayerDimension,\n};\n\nexport default withStreamClaimRender(connect(null, perform)(VideoClaimInitiator));\n","import { connect } from 'react-redux';\nimport { withRouter } from 'react-router-dom';\n\nimport * as SETTINGS from 'constants/settings';\nimport * as TAGS from 'constants/tags';\n\nimport { getChannelIdFromClaim } from 'util/claim';\nimport { LINKED_COMMENT_QUERY_PARAM, THREAD_COMMENT_QUERY_PARAM } from 'constants/comment';\n\nimport {\n  selectClaimIsNsfwForUri,\n  selectClaimForUri,\n  makeSelectTagInClaimOrChannelForUri,\n} from 'redux/selectors/claims';\nimport { makeSelectFileInfoForUri } from 'redux/selectors/file_info';\nimport { selectClientSetting } from 'redux/selectors/settings';\nimport {\n  selectContentPositionForUri,\n  selectPlayingCollectionId,\n  selectIsUriCurrentlyPlaying,\n  selectIsAutoplayCountdownForUri,\n} from 'redux/selectors/content';\nimport { selectCommentsListTitleForUri, selectCommentsDisabledSettingForChannelId } from 'redux/selectors/comments';\nimport { selectNoRestrictionOrUserIsMemberForContentClaimId } from 'redux/selectors/memberships';\nimport { clearPosition } from 'redux/actions/content';\n\nimport VideoPlayersPage from './view';\n\nconst select = (state, props) => {\n  const { uri } = props;\n  const { search } = location;\n\n  const urlParams = new URLSearchParams(search);\n  const playingCollectionId = selectPlayingCollectionId(state);\n  const claim = selectClaimForUri(state, uri);\n  const channelId = getChannelIdFromClaim(claim);\n\n  const claimId = claim.claim_id;\n\n  const commentSettingDisabled = selectCommentsDisabledSettingForChannelId(state, channelId);\n\n  return {\n    commentsListTitle: selectCommentsListTitleForUri(state, uri),\n    fileInfo: makeSelectFileInfoForUri(uri)(state),\n    isMature: selectClaimIsNsfwForUri(state, uri),\n    isUriPlaying: selectIsUriCurrentlyPlaying(state, uri),\n    linkedCommentId: urlParams.get(LINKED_COMMENT_QUERY_PARAM),\n    threadCommentId: urlParams.get(THREAD_COMMENT_QUERY_PARAM),\n    playingCollectionId,\n    position: selectContentPositionForUri(state, uri),\n    commentsDisabled:\n      commentSettingDisabled || makeSelectTagInClaimOrChannelForUri(uri, TAGS.DISABLE_COMMENTS_TAG)(state),\n    videoTheaterMode: selectClientSetting(state, SETTINGS.VIDEO_THEATER_MODE),\n    contentUnlocked: claimId && selectNoRestrictionOrUserIsMemberForContentClaimId(state, claimId),\n    isAutoplayCountdownForUri: selectIsAutoplayCountdownForUri(state, uri),\n  };\n};\n\nconst perform = {\n  clearPosition,\n};\n\nexport default withRouter(connect(select, perform)(VideoPlayersPage));\n","// @flow\nimport { VIDEO_ALMOST_FINISHED_THRESHOLD } from 'constants/player';\nimport * as React from 'react';\nimport { lazyImport } from 'util/lazyImport';\nimport * as ICONS from 'constants/icons';\nimport * as DRAWERS from 'constants/drawer_types';\nimport * as COLLECTIONS_CONSTS from 'constants/collections';\nimport FileTitleSection from 'component/fileTitleSection';\nimport VideoClaimInitiator from 'component/videoClaimInitiator';\nimport ClaimCoverRender from 'component/claimCoverRender';\nimport RecommendedContent from 'component/recommendedContent';\nimport Empty from 'component/common/empty';\nimport SwipeableDrawer from 'component/swipeableDrawer';\nimport DrawerExpandButton from 'component/swipeableDrawerExpand';\nimport { useIsMobile, useIsMobileLandscape, useIsSmallScreen } from 'effects/use-screensize';\n\nconst CommentsList = lazyImport(() => import('component/commentsList' /* webpackChunkName: \"comments\" */));\nconst PlaylistCard = lazyImport(() => import('component/playlistCard' /* webpackChunkName: \"playlistCard\" */));\n\nexport const PRIMARY_PLAYER_WRAPPER_CLASS = 'file-page__video-container';\nexport const PRIMARY_IMAGE_WRAPPER_CLASS = 'file-render__img-container';\n\ntype Props = {\n  uri: string,\n  accessStatus: ?string,\n  // -- redux --\n  audioVideoDuration: ?number,\n  commentsListTitle: string,\n  fileInfo: FileListItem,\n  isMature: boolean,\n  isUriPlaying: boolean,\n  linkedCommentId?: string,\n  threadCommentId?: string,\n  location: { search: string },\n  playingCollectionId: ?string,\n  position: number,\n  commentsDisabled: ?boolean,\n  videoTheaterMode: boolean,\n  contentUnlocked: boolean,\n  isAutoplayCountdownForUri: ?boolean,\n  clearPosition: (uri: string) => void,\n};\n\nexport default function VideoPlayersPage(props: Props) {\n  const {\n    uri,\n    accessStatus,\n    // -- redux --\n    playingCollectionId,\n    fileInfo,\n    isMature,\n    linkedCommentId,\n    threadCommentId,\n    videoTheaterMode,\n    commentsDisabled,\n    audioVideoDuration,\n    commentsListTitle,\n    isUriPlaying,\n    location,\n    position,\n    contentUnlocked,\n    isAutoplayCountdownForUri,\n    clearPosition,\n  } = props;\n\n  const isMobile = useIsMobile();\n  const isSmallScreen = useIsSmallScreen() && !isMobile;\n  const isLandscapeRotated = useIsMobileLandscape();\n\n  const initialPlayingCol = React.useRef(playingCollectionId);\n\n  const { search } = location;\n  const urlParams = new URLSearchParams(search);\n  const colParam = urlParams.get(COLLECTIONS_CONSTS.COLLECTION_ID);\n\n  const collectionId = React.useMemo(() => {\n    const startedPlayingOtherPlaylist =\n      (isUriPlaying || playingCollectionId === null) &&\n      playingCollectionId !== undefined &&\n      !initialPlayingCol.current !== playingCollectionId;\n    return startedPlayingOtherPlaylist ? playingCollectionId : colParam;\n  }, [colParam, isUriPlaying, playingCollectionId]);\n\n  const rightSideProps = React.useMemo(\n    () => ({ collectionId, uri, isSmallScreen }),\n    [collectionId, isSmallScreen, uri]\n  );\n\n  const videoPlayedEnoughToResetPosition = React.useMemo(() => {\n    // I've never seen 'fileInfo' contain metadata lately, but retaining as historical fallback.\n    const durationInSecs =\n      audioVideoDuration ||\n      (fileInfo && fileInfo.metadata && fileInfo.metadata.video ? fileInfo.metadata.video.duration : 0);\n    const isVideoTooShort = durationInSecs <= 45;\n    const almostFinishedPlaying = position / durationInSecs >= VIDEO_ALMOST_FINISHED_THRESHOLD;\n\n    return durationInSecs ? isVideoTooShort || almostFinishedPlaying : false;\n  }, [audioVideoDuration, fileInfo, position]);\n\n  React.useEffect(() => {\n    // always refresh file info when entering file page to see if we have the file\n    // this could probably be refactored into more direct components now\n    if (fileInfo && videoPlayedEnoughToResetPosition) {\n      clearPosition(uri);\n    }\n  }, [clearPosition, fileInfo, uri, videoPlayedEnoughToResetPosition]);\n\n  if (isMature) {\n    return (\n      <>\n        <div className=\"section card-stack file-page__video\">\n          {isAutoplayCountdownForUri && (\n            <div className={PRIMARY_PLAYER_WRAPPER_CLASS}>\n              <ClaimCoverRender uri={uri} />\n            </div>\n          )}\n\n          <FileTitleSection uri={uri} accessStatus={accessStatus} isNsfwBlocked />\n        </div>\n\n        {isSmallScreen && <PlaylistCard id={collectionId} uri={uri} useDrawer={isMobile} />}\n        {!videoTheaterMode && <RightSideContent {...rightSideProps} />}\n      </>\n    );\n  }\n\n  const commentsListProps = { uri, linkedCommentId, threadCommentId };\n  return (\n    <>\n      <div className=\"section card-stack file-page__video\">\n        <div className={PRIMARY_PLAYER_WRAPPER_CLASS}>\n          <VideoClaimInitiator uri={uri} />\n        </div>\n\n        <div className=\"file-page__secondary-content\">\n          <section className=\"file-page__media-actions\">\n            {isSmallScreen && <PlaylistCard id={collectionId} uri={uri} useDrawer={isMobile} />}\n\n            <FileTitleSection uri={uri} accessStatus={accessStatus} />\n\n            {contentUnlocked &&\n              (commentsDisabled ? (\n                <Empty padded={!isMobile} text={__('The creator of this content has disabled comments.')} />\n              ) : isMobile && !isLandscapeRotated ? (\n                <React.Fragment>\n                  <SwipeableDrawer type={DRAWERS.CHAT} title={<h2>{commentsListTitle}</h2>}>\n                    <React.Suspense fallback={null}>\n                      <CommentsList {...commentsListProps} />\n                    </React.Suspense>\n                  </SwipeableDrawer>\n\n                  <DrawerExpandButton icon={ICONS.CHAT} label={<h2>{commentsListTitle}</h2>} type={DRAWERS.CHAT} />\n                </React.Fragment>\n              ) : (\n                <React.Suspense fallback={null}>\n                  <CommentsList {...commentsListProps} notInDrawer />\n                </React.Suspense>\n              ))}\n          </section>\n\n          {videoTheaterMode && <RightSideContent {...rightSideProps} />}\n        </div>\n      </div>\n\n      {!videoTheaterMode && <RightSideContent {...rightSideProps} />}\n    </>\n  );\n}\n\ntype RightSideProps = {\n  collectionId: ?string,\n  uri: string,\n  isSmallScreen: boolean,\n};\n\nconst RightSideContent = (rightSideProps: RightSideProps) => {\n  const { collectionId, uri, isSmallScreen } = rightSideProps;\n\n  const isMobile = useIsMobile();\n\n  return (\n    <div className=\"card-stack--spacing-m\">\n      {!isSmallScreen && <PlaylistCard id={collectionId} uri={uri} useDrawer={isMobile} />}\n      <RecommendedContent uri={uri} />\n    </div>\n  );\n};\n"],"names":["props","uri","children","streamClaim","doSetMainPlayerDimension","playerRef","React","node","rect","getBoundingClientRect","ClaimCoverRender","onClick","passedRef","Button","className","iconSize","title","__","perform","withStreamClaimRender","connect","VideoClaimInitiator","clearPosition","withRouter","state","search","location","urlParams","URLSearchParams","playingCollectionId","selectPlayingCollectionId","claim","selectClaimForUri","channelId","getChannelIdFromClaim","claimId","claim_id","commentSettingDisabled","selectCommentsDisabledSettingForChannelId","commentsListTitle","selectCommentsListTitleForUri","fileInfo","makeSelectFileInfoForUri","isMature","selectClaimIsNsfwForUri","isUriPlaying","selectIsUriCurrentlyPlaying","linkedCommentId","get","LINKED_COMMENT_QUERY_PARAM","threadCommentId","THREAD_COMMENT_QUERY_PARAM","position","selectContentPositionForUri","commentsDisabled","makeSelectTagInClaimOrChannelForUri","TAGS","videoTheaterMode","selectClientSetting","SETTINGS","contentUnlocked","selectNoRestrictionOrUserIsMemberForContentClaimId","isAutoplayCountdownForUri","selectIsAutoplayCountdownForUri","VideoPlayersPage","CommentsList","lazyImport","PlaylistCard","PRIMARY_PLAYER_WRAPPER_CLASS","accessStatus","audioVideoDuration","isMobile","useIsMobile","isSmallScreen","useIsSmallScreen","isLandscapeRotated","useIsMobileLandscape","initialPlayingCol","colParam","COLLECTIONS_CONSTS","collectionId","undefined","current","rightSideProps","videoPlayedEnoughToResetPosition","durationInSecs","metadata","video","duration","isVideoTooShort","almostFinishedPlaying","VIDEO_ALMOST_FINISHED_THRESHOLD","FileTitleSection","isNsfwBlocked","id","useDrawer","RightSideContent","commentsListProps","Empty","padded","text","SwipeableDrawer","type","DRAWERS","fallback","DrawerExpandButton","icon","ICONS","label","_extends","notInDrawer","RecommendedContent"],"sourceRoot":""}