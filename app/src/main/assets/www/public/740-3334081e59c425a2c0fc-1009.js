"use strict";(self.webpackChunkodysee_com=self.webpackChunkodysee_com||[]).push([[740],{30740:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Q});var r=n(2927),o=n(16395),a=n(95810),c=n(63400),l=n(77369),i=n(44908),m=n(51635),s=n(66598),u=n.n(s),d=n(69809),f=n(76333),h=n(85311),p=n(88441),C=n(91616),b=n(29679),E=n(16643),v=n(24582),y=n(7920),g=n(29454),S=n(81352),I=n(58210),_=n(17185),w=n(52338),O=n(33441),M=n(28180),T=n(96284),R=n(71036).__;const N=function(e){var t=e.claimId,n=e.channelId,r=e.channelName,o=e.claimIsMine,a=e.channelHasMembershipTiers,c=e.areCommentsMembersOnly,i=e.creatorMembershipsFetched,m=e.doToggleMembersOnlyCommentsSettingForClaimId,s=e.doMembershipList,u=e.doToast;return p.useEffect((function(){!i&&r&&n&&s({channel_claim_id:n})}),[n,r,i,s]),a&&o?p.createElement(M.v2,null,p.createElement(M.j2,{className:"button button--alt menu__button"},p.createElement(T.default,{size:18,icon:l.SETTINGS})),p.createElement(M.qy,{className:"menu__list"},p.createElement(M.sN,{className:"comment__menu-option",onSelect:function(){t&&m(t).then((function(){return u({message:R(c?"Members-only comments are now disabled.":"Members-only comments are now enabled.")})}))}},p.createElement("span",{className:"menu__link"},p.createElement(T.default,{"aria-hidden":!0,icon:l.MEMBERSHIP}),R(c?"Disable members-only comments":"Enable members-only comments"))))):null};var k={doToggleMembersOnlyCommentsSettingForClaimId:_.xw,doMembershipList:w.OT,doToast:O.QJ};const A=(0,v.$j)((function(e,t){var n=t.uri,r=(0,y.B0y)(e,n),o=r&&r.claim_id,a=(0,I.tg)(r)||{},c=a.claim_id;return{claimId:o,channelId:c,channelName:a.name,claimIsMine:(0,y.ZJr)(e,n),channelHasMembershipTiers:c&&(0,S.R)(e,c),areCommentsMembersOnly:c&&(0,g.uy)(e,c),creatorMembershipsFetched:(0,S.p$)(e,n)}}),k)(N);var L=n(13690),F=n(71036).__,P=["activeSort","sortOption","changeSort"];function j(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function B(){return B=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},B.apply(this,arguments)}function Y(e){return function(e){if(Array.isArray(e))return U(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||H(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,l=[],i=!0,m=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);i=!0);}catch(e){m=!0,o=e}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(m)throw o}}return l}}(e,t)||H(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){if(e){if("string"==typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(e,t):void 0}}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Z=200,D=(0,L.e)((function(){return Promise.all([n.e(5904),n.e(2461),n.e(8324)]).then(n.bind(n,93148))}));var W=function(e){var t=e.uri,n=e.totalUnfilteredComments,a=e.sort,c=e.changeSort,m=e.handleRefresh,s={activeSort:a,changeSort:c};return p.createElement("div",{className:"comment__actions"},n>1&&o.ENABLE_COMMENT_REACTIONS&&p.createElement("span",{className:"comment__sort"},p.createElement(V,B({},s,{label:F("Best"),icon:l.BEST,sortOption:r.dY.POPULARITY})),p.createElement(V,B({},s,{label:F("Controversial"),icon:l.CONTROVERSIAL,sortOption:r.dY.CONTROVERSY})),p.createElement(V,B({},s,{label:F("New"),icon:l.NEW,sortOption:r.dY.NEWEST}))),p.createElement("div",{className:"comment__settings"},p.createElement(i.default,{button:"alt",icon:l.REFRESH,title:F("Refresh"),onClick:m}),p.createElement(A,{uri:t})))},V=function(e){var t=e.activeSort,n=e.sortOption,r=e.changeSort,o=j(e,P);return p.createElement(i.default,B({},o,{className:u()("button-toggle",{"button-toggle--active":t===n}),button:"alt",iconSize:18,onClick:function(){return r(n)}}))},z=function(e){var t=e.label,n=e.isViewAll,o=e.threadCommentParent,a=e.threadCommentId,c=(0,E.useHistory)(),m=c.push,s=c.location,u=s.pathname,d=s.search;return p.createElement(i.default,{button:"link",label:t,icon:l.ARROW_LEFT,iconSize:12,onClick:function(){var e=new URLSearchParams(d);n?(e.delete(r.ee),e.set(r.Hj,o)):(e.set(r.ee,o),e.set(r.Hj,a)),window.pendingLinkedCommentScroll=!0,m({pathname:u,search:e.toString()})}})},$=n(44692),q=n(88374),G={fetchTopLevelComments:_.Xp,fetchComment:_.pf,fetchReacts:_.wk,resetComments:_.vg,doFetchOdyseeMembershipForChannelIds:w.i6,doFetchChannelMembershipsForChannelIds:w.RG,doPopOutInlinePlayer:$.aH};const Q=(0,v.$j)((function(e,t){var n=t.uri,r=t.threadCommentId,o=t.linkedCommentId,a=(0,y.B0y)(e,n),c=(0,I._I)(a),l=(0,q.YG)(e),i=(0,g.xT)(e,r);return{activeChannelId:l&&l.claim_id,allCommentIds:(0,g.RT)(e,n),channelId:c,chatCommentsRestrictedToChannelMembers:Boolean((0,y.RvA)(e,n)),claimId:a&&a.claim_id,claimIsMine:(0,y.pDP)(e,a),fetchingChannels:(0,y.Y7j)(e),isAChannelMember:(0,S.QL)(e,c),isFetchingComments:(0,g.vz)(e),isFetchingReacts:(0,g.xs)(e),isFetchingTopLevelComments:(0,g.DV)(e),linkedCommentAncestors:(0,g.kP)(e,o),commentsEnabledSetting:(0,g.E7)(e,c),myReactsByCommentId:(0,g.zQ)(e),othersReactsById:(0,g._M)(e),pinnedComments:(0,g.ZY)(e,n),threadComment:i,threadCommentAncestors:(0,g.kP)(e,r),topLevelComments:(0,g.C2)(e,n),topLevelTotalPages:(0,g.TY)(e,n),totalComments:(0,g.pC)(e,n),scheduledState:(0,y.r_k)(e,n)}}),G)((function(e){var t,n=e.allCommentIds,l=e.uri,s=e.pinnedComments,v=e.topLevelComments,y=e.topLevelTotalPages,g=e.claimId,S=e.channelId,I=e.claimIsMine,_=e.isFetchingComments,w=e.isFetchingTopLevelComments,O=e.isFetchingReacts,M=e.linkedCommentId,T=e.totalComments,R=e.fetchingChannels,N=e.myReactsByCommentId,k=e.othersReactsById,A=e.activeChannelId,L=e.commentsEnabledSetting,P=e.commentsAreExpanded,j=e.threadCommentId,H=e.threadComment,U=e.notInDrawer,V=e.threadCommentAncestors,$=e.linkedCommentAncestors,q=e.fetchTopLevelComments,G=e.fetchComment,Q=e.fetchReacts,J=e.resetComments,X=e.doFetchOdyseeMembershipForChannelIds,K=e.doPopOutInlinePlayer,ee=e.doFetchChannelMembershipsForChannelIds,te=e.chatCommentsRestrictedToChannelMembers,ne=e.isAChannelMember,re=e.scheduledState,oe=p.useRef(!1),ae=(0,E.useHistory)(),ce=ae.push,le=ae.location,ie=le.pathname,me=le.search,se=(0,a.dD)(),ue=(0,a.Dv)(),de=Math.ceil(v.length/r.t5),fe=p.useRef(),he=p.useRef(),pe=o.ENABLE_COMMENT_REACTIONS?r.dY.POPULARITY:r.dY.NEWEST,Ce=x((0,b.Z)("comment-sort-by",pe),2),be=Ce[0],Ee=Ce[1],ve=x(p.useState(de>0?de:1),2),ye=ve[0],ge=ve[1],Se=x(p.useState(!1),2),Ie=Se[0],_e=Se[1],we=P||!ue||se,Oe=x(p.useState(we),2),Me=Oe[0],Te=Oe[1],Re=x(p.useState(),2),Ne=Re[0],ke=Re[1],Ae=x(p.useState([]),2),Le=Ae[0],Fe=Ae[1],Pe=p.useCallback((function(e){Fe((function(t){var n=e.filter((function(e){return!t.includes(e)}));return n.length>0?[].concat(Y(t),Y(n)):t}))}),[]),je=T>0?T-Le.length:T,Be=n?n.length:0,Ye=ye<y,xe=(0,c.YD)(je),He=se?3:10;V&&V.some((function(e,n){if(n>=He-1)return!0;t=e}));var Ue=V&&V[V.length-1],Ze=x(p.useState(Boolean(k)||!o.ENABLE_COMMENT_REACTIONS),2),De=Ze[0],We=Ze[1],Ve=p.useMemo((function(){return v.map((function(e){return e.channel_id}))}),[v]);p.useEffect((function(){Ve.length>0&&S&&(X(Ve),ee(S,Ve))}),[S,Ve.length,ee,X]);var ze=p.useCallback((function(){g&&J(g),ge(1)}),[g,J]);function $e(){ge(0),K({source:"comment"})}p.useEffect((function(){if(!j&&M&&$&&$.length>He-1&&!oe.current){var e=new URLSearchParams(me);e.set(r.ee,M),ce({pathname:ie,search:e.toString()}),oe.current=!0}}),[$,M,ie,ce,me,j,He]);var qe=te&&!ne&&!I;(0,p.useEffect)((function(){Ne&&Ne===l&&(ge(ye+1),ke(void 0))}),[Ne,l]),(0,p.useEffect)((function(){0===ye&&ze()}),[ze,ye]),(0,p.useEffect)((function(){return function(){return ge(1)}}),[l]),(0,p.useEffect)((function(){ye<de&&ge(de>0?de:1)}),[l]),(0,p.useEffect)((function(){var e=1!==ye&&ye!==de,t=Number(0===de)^Number(e);0!==ye&&t&&(1===ye&&(j&&G(j),M&&G(M)),q(l,void 0,ye,r.t5,be,!1))}),[de,G,q,M,ye,be,j,l]),p.useEffect((function(){j&&$e()}),[j]),(0,p.useEffect)((function(){var e;Be>0&&o.ENABLE_COMMENT_REACTIONS&&!R&&!O&&(0!==(e=k&&N?n.filter((function(e){var t=A?"".concat(e,":").concat(A):e;return!k[t]||A&&!N[t]})):n).length&&Q(e).then((function(){We(!0)})).catch((function(){return We(!0)})))}),[A,n,Q,R,O,N,k,Be]),(0,p.useEffect)((function(){M||j?window.pendingLinkedCommentScroll=!0:delete window.pendingLinkedCommentScroll}),[]),(0,p.useEffect)((function(){if(0!==v.length){var e=(0,f.Z)((function(){n(ye,y)&&(ke(l),_e(!0))}),Z);if(Ie||(e(),_e(!0)),we&&!_&&De&&Ye){var t=Boolean(document.querySelector(".MuiDrawer-root .card--enable-overflow"))?document.querySelector(".card--enable-overflow"):window;if(t)return t.addEventListener("scroll",e),function(){return t.removeEventListener("scroll",e)}}}function n(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;if(!fe||!fe.current)return!1;var r,o,a=fe.current.getBoundingClientRect(),c=window.innerHeight||document.documentElement.clientHeight,l=window.innerWidth||document.documentElement.clientWidth,i=0!==n&&a.top<c+(r=n,(o=window.devicePixelRatio||1)<1?Math.ceil(r/o):Math.ceil(r*o));return(a.width>0&&a.height>0&&a.bottom>=0&&a.right>=0&&a.top<=c&&a.left<=l||i)&&e<t}}),[v,we,Ie,_,se,Ye,ye,De,y,l]);var Ge={isTopLevel:!0,uri:l,linkedCommentId:M,threadCommentId:j,threadDepthLevel:He},Qe={uri:l,totalUnfilteredComments:je,sort:be,changeSort:function(e){be!==e&&(Ee(e),$e(),K({source:"comment"}))},handleRefresh:$e};return"scheduled"===re?null:p.createElement(m.Z,{className:"card--enable-overflow comment__list",title:(!se||U)&&xe,titleActions:p.createElement(W,Qe),actions:p.createElement(p.Fragment,null,se&&!U&&p.createElement(W,Qe),p.createElement(D,{uri:l}),j&&H&&p.createElement("span",{className:"comment__actions comment__thread-links"},p.createElement(z,{label:F("View all comments"),threadCommentParent:Ue||j,threadCommentId:j,isViewAll:!0}),t&&p.createElement(z,{label:F("Show parent comments"),threadCommentParent:t,threadCommentId:j})),L&&!_&&!je&&!j&&p.createElement(h.Z,{padded:!0,text:F("That was pretty deep. What do you think?")}),p.createElement("ul",{ref:he,className:u()("comments",{"comments--contracted":ue&&!Me&&je>1})},De&&p.createElement(p.Fragment,null,H&&p.createElement(d.Z,B({key:H.comment_id,comment:H,disabled:qe,updateUiFilteredComments:Pe},Ge)),s&&s.map((function(e){if(!(H&&V&&V.includes(e.comment_id)))return p.createElement(d.Z,B({key:e.comment_id,comment:e,disabled:qe,updateUiFilteredComments:Pe},Ge))})),v.map((function(e){if(!(H&&V&&V.includes(e.comment_id)))return p.createElement(d.Z,B({key:e.comment_id,comment:e,disabled:qe,updateUiFilteredComments:Pe},Ge))})))),!we&&p.createElement("div",{className:"card__bottom-actions card__bottom-actions--comments"},(!Me||Ye)&&je>1&&p.createElement(i.default,{button:"link",title:F(Me?"More":"Expand"),label:F(Me?"More":"Expand"),onClick:function(){return Me?ge(ye+1):Te(!0)}}),Me&&je>1&&p.createElement(i.default,{button:"link",title:F("Collapse"),label:F("Collapse"),onClick:function(){if(Te(!1),he.current){var e=he.current.getBoundingClientRect().top;window.scrollTo({top:e+window.pageYOffset-200,behavior:"smooth"})}}})),(j?!De:w||we&&Ye)&&p.createElement("div",{className:"main--empty",ref:fe},p.createElement(C.Z,{type:"small"})))})}))}}]);
//# sourceMappingURL=740-3334081e59c425a2c0fc-1009.js.map